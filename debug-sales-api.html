<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®æ¨¡å—å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .test-section h3 {
            color: #409eff;
            margin-top: 0;
        }
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #66b1ff;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left: 4px solid #67c23a;
        }
        .error {
            border-left: 4px solid #f56c6c;
            color: #f56c6c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” é”€å”®APIè°ƒè¯•å·¥å…·</h1>
        
        <div class="test-section">
            <h3>1. ç›´æ¥æµ‹è¯•å¾®æœåŠ¡API</h3>
            <button class="test-button" onclick="testDirectMicroservice()">æµ‹è¯•é”€å”®è®¢å•API</button>
            <button class="test-button" onclick="testDirectCustomers()">æµ‹è¯•å®¢æˆ·API</button>
            <div id="direct-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. æµ‹è¯•å‰ç«¯APIå±‚</h3>
            <button class="test-button" onclick="testFrontendOrders()">æµ‹è¯•å‰ç«¯è®¢å•API</button>
            <button class="test-button" onclick="testFrontendCustomers()">æµ‹è¯•å‰ç«¯å®¢æˆ·API</button>
            <div id="frontend-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. æµ‹è¯•çŠ¶æ€ç®¡ç†</h3>
            <button class="test-button" onclick="testSalesStore()">æµ‹è¯•é”€å”®Store</button>
            <div id="store-result" class="result"></div>
        </div>
    </div>

    <script>
        // ç›´æ¥æµ‹è¯•å¾®æœåŠ¡API
        async function testDirectMicroservice() {
            const resultDiv = document.getElementById('direct-result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•å¾®æœåŠ¡API...';
            
            try {
                // æµ‹è¯•é”€å”®è®¢å•
                console.log('ğŸ” æµ‹è¯•é”€å”®è®¢å•API...');
                const ordersResponse = await fetch('/api/v1/sales/orders?page=1&limit=5');
                const ordersData = await ordersResponse.json();
                
                console.log('ğŸ“¥ è®¢å•APIå“åº”:', ordersData);
                
                resultDiv.innerHTML = `âœ… å¾®æœåŠ¡APIæµ‹è¯•æˆåŠŸï¼

è®¢å•APIå“åº”:
${JSON.stringify(ordersData, null, 2)}

å“åº”çŠ¶æ€: ${ordersResponse.status}
å“åº”å¤´: ${JSON.stringify(Object.fromEntries(ordersResponse.headers.entries()), null, 2)}`;
                resultDiv.className = 'result success';
                
            } catch (error) {
                console.error('âŒ å¾®æœåŠ¡APIæµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ å¾®æœåŠ¡APIæµ‹è¯•å¤±è´¥:
${error.message}

é”™è¯¯è¯¦æƒ…:
${JSON.stringify(error, null, 2)}`;
                resultDiv.className = 'result error';
            }
        }

        async function testDirectCustomers() {
            const resultDiv = document.getElementById('direct-result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•å®¢æˆ·API...';
            
            try {
                console.log('ğŸ” æµ‹è¯•å®¢æˆ·API...');
                const customersResponse = await fetch('/api/v1/sales/customers?page=1&limit=5');
                const customersData = await customersResponse.json();
                
                console.log('ğŸ“¥ å®¢æˆ·APIå“åº”:', customersData);
                
                resultDiv.innerHTML = `âœ… å®¢æˆ·APIæµ‹è¯•æˆåŠŸï¼

å®¢æˆ·APIå“åº”:
${JSON.stringify(customersData, null, 2)}

å“åº”çŠ¶æ€: ${customersResponse.status}`;
                resultDiv.className = 'result success';
                
            } catch (error) {
                console.error('âŒ å®¢æˆ·APIæµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ å®¢æˆ·APIæµ‹è¯•å¤±è´¥:
${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // æµ‹è¯•å‰ç«¯APIå±‚
        async function testFrontendOrders() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•å‰ç«¯APIå±‚...';
            
            try {
                // æ¨¡æ‹Ÿå‰ç«¯APIè°ƒç”¨
                console.log('ğŸ” æµ‹è¯•å‰ç«¯APIå±‚...');
                
                // è¿™é‡Œéœ€è¦æ¨¡æ‹Ÿå‰ç«¯çš„APIè°ƒç”¨é€»è¾‘
                const response = await fetch('/api/v1/sales/orders?page=1&limit=5');
                const rawData = await response.json();
                
                console.log('ğŸ“¥ å‰ç«¯APIåŸå§‹æ•°æ®:', rawData);
                
                // æ¨¡æ‹Ÿå‰ç«¯æ•°æ®å¤„ç†é€»è¾‘
                let orders = [];
                let total = 0;
                let page = 1;
                let limit = 20;
                
                if (Array.isArray(rawData)) {
                    orders = rawData;
                    total = orders.length;
                } else if (rawData.success && rawData.data) {
                    const apiData = rawData.data;
                    if (Array.isArray(apiData.orders)) {
                        orders = apiData.orders;
                        total = apiData.pagination?.total || orders.length;
                        page = apiData.pagination?.page || 1;
                        limit = apiData.pagination?.limit || 20;
                    } else if (Array.isArray(apiData.items)) {
                        orders = apiData.items;
                        total = apiData.total || orders.length;
                        page = apiData.page || 1;
                        limit = apiData.limit || 20;
                    }
                }
                
                resultDiv.innerHTML = `âœ… å‰ç«¯APIå±‚æµ‹è¯•æˆåŠŸï¼

åŸå§‹æ•°æ®ç»“æ„:
${JSON.stringify(rawData, null, 2)}

è§£æåçš„æ•°æ®:
- è®¢å•æ•°é‡: ${orders.length}
- æ€»æ•°: ${total}
- é¡µç : ${page}
- æ¯é¡µæ•°é‡: ${limit}

ç¬¬ä¸€ä¸ªè®¢å•:
${JSON.stringify(orders[0] || null, null, 2)}`;
                resultDiv.className = 'result success';
                
            } catch (error) {
                console.error('âŒ å‰ç«¯APIå±‚æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ å‰ç«¯APIå±‚æµ‹è¯•å¤±è´¥:
${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testFrontendCustomers() {
            const resultDiv = document.getElementById('frontend-result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•å‰ç«¯å®¢æˆ·API...';
            
            try {
                console.log('ğŸ” æµ‹è¯•å‰ç«¯å®¢æˆ·API...');
                
                const response = await fetch('/api/v1/sales/customers?page=1&limit=5');
                const rawData = await response.json();
                
                console.log('ğŸ“¥ å‰ç«¯å®¢æˆ·APIåŸå§‹æ•°æ®:', rawData);
                
                // æ¨¡æ‹Ÿå‰ç«¯æ•°æ®å¤„ç†é€»è¾‘
                let customers = [];
                let total = 0;
                
                if (Array.isArray(rawData)) {
                    customers = rawData;
                    total = customers.length;
                } else if (rawData.success && rawData.data) {
                    const apiData = rawData.data;
                    if (Array.isArray(apiData.customers)) {
                        customers = apiData.customers;
                        total = apiData.pagination?.total || customers.length;
                    } else if (Array.isArray(apiData.items)) {
                        customers = apiData.items;
                        total = apiData.total || customers.length;
                    }
                }
                
                resultDiv.innerHTML = `âœ… å‰ç«¯å®¢æˆ·APIæµ‹è¯•æˆåŠŸï¼

åŸå§‹æ•°æ®ç»“æ„:
${JSON.stringify(rawData, null, 2)}

è§£æåçš„æ•°æ®:
- å®¢æˆ·æ•°é‡: ${customers.length}
- æ€»æ•°: ${total}

ç¬¬ä¸€ä¸ªå®¢æˆ·:
${JSON.stringify(customers[0] || null, null, 2)}`;
                resultDiv.className = 'result success';
                
            } catch (error) {
                console.error('âŒ å‰ç«¯å®¢æˆ·APIæµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ å‰ç«¯å®¢æˆ·APIæµ‹è¯•å¤±è´¥:
${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // æµ‹è¯•çŠ¶æ€ç®¡ç†
        async function testSalesStore() {
            const resultDiv = document.getElementById('store-result');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•çŠ¶æ€ç®¡ç†...';
            
            try {
                console.log('ğŸ” æµ‹è¯•çŠ¶æ€ç®¡ç†...');
                
                // è¿™é‡Œéœ€è¦æ£€æŸ¥Vueåº”ç”¨æ˜¯å¦å¯ç”¨
                if (typeof window.Vue === 'undefined') {
                    throw new Error('Vueåº”ç”¨æœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•çŠ¶æ€ç®¡ç†');
                }
                
                resultDiv.innerHTML = `âš ï¸ çŠ¶æ€ç®¡ç†æµ‹è¯•éœ€è¦åœ¨Vueåº”ç”¨ç¯å¢ƒä¸­è¿è¡Œ
                
è¯·åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­è¿è¡Œä»¥ä¸‹ä»£ç æ¥æµ‹è¯•çŠ¶æ€ç®¡ç†:

// 1. æ£€æŸ¥é”€å”®Storeæ˜¯å¦å¯ç”¨
const salesStore = useSalesStore();
console.log('é”€å”®Store:', salesStore);

// 2. æµ‹è¯•è·å–è®¢å•
await salesStore.fetchOrders();
console.log('è®¢å•æ•°æ®:', salesStore.orders);

// 3. æµ‹è¯•è·å–å®¢æˆ·
await salesStore.fetchCustomers();
console.log('å®¢æˆ·æ•°æ®:', salesStore.customers);`;
                resultDiv.className = 'result';
                
            } catch (error) {
                console.error('âŒ çŠ¶æ€ç®¡ç†æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `âŒ çŠ¶æ€ç®¡ç†æµ‹è¯•å¤±è´¥:
${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸš€ é”€å”®APIè°ƒè¯•å·¥å…·å·²åŠ è½½');
            console.log('è¯·ç‚¹å‡»æŒ‰é’®è¿›è¡Œå„é¡¹æµ‹è¯•');
        });
    </script>
</body>
</html>