# é¥²å–‚APIè°ƒè¯•æŒ‡å—

## ğŸ” 500é”™è¯¯æ’æŸ¥

å½“å‰æ‰€æœ‰é¥²å–‚æ€»è§ˆé¡µé¢çš„APIè¯·æ±‚éƒ½è¿”å›500é”™è¯¯ï¼Œè¿™è¡¨æ˜åç«¯ä»£ç æœ‰ä¸¥é‡é—®é¢˜ã€‚

## ğŸ› ï¸ å·²å®Œæˆçš„ä¿®å¤

### 1. ç®€åŒ–getFeedingEfficiencyæ–¹æ³•
- âœ… ç§»é™¤äº†å¤æ‚çš„æ¨¡å‹å…³è”æŸ¥è¯¢
- âœ… ä½¿ç”¨ç®€å•çš„æˆæœ¬ä¼°ç®—
- âœ… æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯å¤„ç†

### 2. ç®€åŒ–æ§åˆ¶å™¨æŸ¥è¯¢
- âœ… ç§»é™¤äº†å¤æ‚çš„includeæŸ¥è¯¢
- âœ… ä½¿ç”¨rawæŸ¥è¯¢é¿å…å…³è”é—®é¢˜
- âœ… æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

### 3. å‚æ•°éªŒè¯
- âœ… æ·»åŠ äº†å®Œæ•´çš„å‚æ•°éªŒè¯
- âœ… ç±»å‹è½¬æ¢å’Œæ ¼å¼æ£€æŸ¥
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ğŸ”§ è°ƒè¯•æ­¥éª¤

### 1. æ£€æŸ¥åç«¯æ—¥å¿—
å¯åŠ¨åç«¯æœåŠ¡åï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š
```bash
cd backend
npm run dev
```

### 2. æµ‹è¯•APIç«¯ç‚¹
ä½¿ç”¨curlæˆ–Postmanæµ‹è¯•APIï¼š
```bash
curl "http://localhost:3000/api/feeding/statistics?base_id=1&start_date=2025-01-01&end_date=2025-01-08"
```

### 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸ï¼Œè¡¨ç»“æ„æ­£ç¡®ã€‚

## ğŸ“‹ å¯èƒ½çš„é—®é¢˜åŸå› 

### 1. æ¨¡å‹å¯¼å…¥é—®é¢˜
- æ£€æŸ¥ `@/models` å¯¼å…¥æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æ‰€æœ‰æ¨¡å‹éƒ½æ­£ç¡®å¯¼å‡º

### 2. æ•°æ®åº“è¿æ¥é—®é¢˜
- æ£€æŸ¥æ•°æ®åº“é…ç½®
- ç¡®ä¿è¡¨å­˜åœ¨ä¸”ç»“æ„æ­£ç¡®

### 3. å¾ªç¯ä¾èµ–é—®é¢˜
- æ¨¡å‹ä¹‹é—´çš„å¾ªç¯å¯¼å…¥
- å…³è”å®šä¹‰é—®é¢˜

### 4. TypeScriptç¼–è¯‘é—®é¢˜
- ç±»å‹å®šä¹‰é”™è¯¯
- ç¼–è¯‘é”™è¯¯

## ğŸš€ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç®€åŒ–çš„APIç«¯ç‚¹è¿›è¡Œæµ‹è¯•ï¼š

```typescript
// åœ¨FeedingControllerä¸­æ·»åŠ ç®€åŒ–çš„æµ‹è¯•ç«¯ç‚¹
static async getSimpleStatistics(req: Request, res: Response) {
  try {
    console.log('ç®€åŒ–ç»Ÿè®¡APIè°ƒç”¨');
    
    const { base_id } = req.query;
    
    if (!base_id) {
      return res.status(400).json({
        success: false,
        message: 'base_id is required'
      });
    }
    
    // æœ€ç®€å•çš„æŸ¥è¯¢
    const count = await FeedingRecord.count({
      where: { base_id: Number(base_id) }
    });
    
    res.json({
      success: true,
      data: {
        basic_stats: {
          total_records: count,
          total_amount: 0,
          avg_amount: 0
        },
        daily_trend: [],
        formula_stats: [],
        barn_stats: [],
        efficiency: {
          totalAmount: 0,
          totalCost: 0,
          averageCostPerKg: 0,
          recordCount: count
        }
      }
    });
  } catch (error) {
    console.error('ç®€åŒ–ç»Ÿè®¡APIé”™è¯¯:', error);
    res.status(500).json({
      success: false,
      message: 'Internal server error',
      error: error.message
    });
  }
}
```

## ğŸ“Š è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
- [ ] æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- [ ] æ¨¡å‹å¯¼å…¥æ˜¯å¦æ­£ç¡®
- [ ] TypeScriptç¼–è¯‘æ˜¯å¦æˆåŠŸ
- [ ] è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
- [ ] ä¸­é—´ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ğŸ” æ—¥å¿—æ£€æŸ¥

å¯åŠ¨åç«¯åï¼Œåº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š
```
é¥²å–‚ç»Ÿè®¡APIæ¥æ”¶å‚æ•°: {base_id: "1", start_date: "2025-01-01", end_date: "2025-01-08"}
å‚æ•°éªŒè¯é€šè¿‡: {baseIdNum: 1, startDateObj: Date, endDateObj: Date}
å¼€å§‹æŸ¥è¯¢é…æ–¹ç»Ÿè®¡...
é…æ–¹ç»Ÿè®¡æŸ¥è¯¢å®Œæˆ: X æ¡è®°å½•
å¼€å§‹æŸ¥è¯¢ç‰›æ£šç»Ÿè®¡...
ç‰›æ£šç»Ÿè®¡æŸ¥è¯¢å®Œæˆ: X æ¡è®°å½•
å¼€å§‹è®¡ç®—é¥²å–‚æ•ˆç‡...
getFeedingEfficiency è°ƒç”¨å‚æ•°: {baseId: 1, startDate: Date, endDate: Date}
getFeedingEfficiency æŸ¥è¯¢ç»“æœ: X æ¡è®°å½•
getFeedingEfficiency è®¡ç®—ç»“æœ: {...}
é¥²å–‚æ•ˆç‡è®¡ç®—å®Œæˆ: {...}
å‡†å¤‡è¿”å›ç»Ÿè®¡æ•°æ®...
```

å¦‚æœæ²¡æœ‰çœ‹åˆ°è¿™äº›æ—¥å¿—ï¼Œè¯´æ˜ä»£ç åœ¨æ›´æ—©çš„åœ°æ–¹å°±å‡ºé”™äº†ã€‚

---

**è°ƒè¯•çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­  
**ä¸‹ä¸€æ­¥**: æ£€æŸ¥åç«¯å¯åŠ¨æ—¥å¿—å’Œå…·ä½“é”™è¯¯ä¿¡æ¯